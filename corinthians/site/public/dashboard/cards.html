<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/imgs/escudo_corinthians2.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de arquibancada | Arena Corinthians</title>

    <!--<link rel="stylesheet" href="../css/style.css">-->
    <link rel="stylesheet" href="../css/dashboards.css">

    <script src="../js/funcoes.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
</head>

<body onload="atualizacaoPeriodica(), mudarNomes()">

    <!--validarSessao(), (colocar isso dentro do onload dps que tudo estiver pronto)-->


    <div class="dash">
        <div class="janela">


            <div class="header-left dash-header">

                <img class="titulo" src="../assets/imgs/escudo_corinthians2.png">

                <div class="hello">
                    <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
                </div>

                <div class="btn-nav">
                    <h3>Teste de arquibancada</h3>
                </div>

                <div class="btn-nav-white">
                    <a href="./mural.html">
                        <h3>Experiências na Arena</h3>
                    </a>
                </div>

                <div class="btn-logout" onclick="limparSessao()">
                    <h3>Sair</h3>
                </div>

            </div>

            <div class="regua">
                <div class="item-regua">
                    <h3>Norte</h3>
                    <h2><span id="cardNorte">0</span> pessoas</h2>
                </div>
                <div class="item-regua">
                    <h3>Sul</h3>
                    <h2><span id="cardSul">0</span> pessoas</h2>
                </div>
                <div class="item-regua">
                    <h3>Leste</h3>
                    <h2><span id="cardLeste">0</span> pessoas</h2>
                </div>
                <div class="item-regua">
                    <h3>Oeste</h3>
                    <h2><span id="cardOeste">0</span> pessoas</h2>
                </div>
                <div class="item-regua">
                    <h3>Oeste Business</h3>
                    <h2><span id="cardOesteB">0</span> pessoas</h2>
                </div>
                <div class="item-regua">
                    <h3>Visitante</h3>
                    <h2><span id="cardVisitante">0</span> pessoas</h2>
                </div>
            </div>

            <div class="cards">
                <div class="card">
                    <h1>Torce para o Corinthians?</h1>
                    <div class="select1">
                        <select id="idSelect1">
                            <option value="sim">Sim</option>
                            <option value="nao">Não</option>
                        </select>
                    </div>
                </div>
                <div class="card">
                    <h1>Estará com crianças ou mulheres?</h1>
                    <div class="select2">
                        <select id="idSelect2">
                            <option value="sim">Sim</option>
                            <option value="nao">Não</option>
                        </select>
                    </div>

                </div>
                <div class="card">
                    <h1>Quer estar perto das torcidas organizadas?</h1>
                    <div class="select3">
                        <select id="idSelect3">
                            <option value="sim">Sim</option>
                            <option value="nao">Não</option>
                        </select>
                    </div>
                </div>
                <div class="card">
                    <h1>Qual a visão do campo que você prefere?</h1>
                    <div class="select4">
                        <select id="idSelect4">
                            <option value="horizontal">Horizontal</option>
                            <option value="vertical">Vertical</option>
                        </select>
                    </div>
                </div>
                <div class="card">
                    <h1>Quanto você está disposto a gastar?</h1>
                    <div class="select5">
                        <select id="idSelect5">
                            <option value="1">$</option>
                            <option value="2">$$</option>
                            <option value="3">$$$</option>
                            <option value="5">$$$$$</option>
                        </select>
                    </div>
                </div>
                <div class="card">
                    <h1>Qual o nível de emoção que você quer?</h1>
                    <div class="select6">
                        <select id="idSelect6">
                            <option value="3">***</option>
                            <option value="4">****</option>
                            <option value="5">*****</option>
                            <option value="1">Quero ter privacidade</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="botao_conferir_container">
                <button class="botao_conferir" onclick="conferirTeste(), salvarSetor()">Conferir</button>
            </div>

        </div>
    </div>
    <div class="box_resultado_selects">
        <h1 class="resultado_selects" id="div_resultado_conferir"></h1>
    </div>
    <div class=boxImg id="boxImg"><img id="imagemSetor" height="500px"></div>


</body>

<script>
    function mudarNomes(){
        setInterval(intervalo, 20000)

        function intervalo() {
            var listaNomes = []
            listaNomes.push(sessionStorage.NOME_USUARIO, 'Corinthiano', 'Fiel torcedor', 'Mosqueteiro', 'Torcedor')
            var contador = 0; 
            while (contador < listaNomes.length) {

                (function (contador) {
                    setTimeout(()=> {
                        b_usuario.innerHTML = listaNomes[contador]
                    }, contador * 4000);
                }
                (contador++));
            }
        }
    }

    var setorTorcedor = ''

    function conferirTeste() {
        var torce = idSelect1.value
        var crianca = idSelect2.value
        var organizadas = idSelect3.value
        var visaoCampo = idSelect4.value
        var dinheiro = Number(idSelect5.value)
        var nvlPrivacidade = Number(idSelect6.value)



        if (torce == "nao") {
            div_resultado_conferir.innerHTML = '';
            div_resultado_conferir.innerHTML = 'O melhor setor para você é o visitante';
            setorTorcedor = 'visitante';
            imagemSetor.src = "";
            imagemSetor.src = "../assets/imgs/setores/setores_visitante.png";
        }

        else if (torce == "sim" && nvlPrivacidade == 5 && crianca == "nao" && dinheiro == 1 && visaoCampo == "vertical" && organizadas == "sim") {
            div_resultado_conferir.innerHTML = '';
            div_resultado_conferir.innerHTML = 'O melhor setor para você é o norte';
            setorTorcedor = 'norte';
            imagemSetor.src = "";
            imagemSetor.src = "../assets/imgs/setores/setores_norte.png";

        }

        else if (torce == "sim" && nvlPrivacidade == 5 && crianca == "nao" && dinheiro == 1 && visaoCampo == "vertical" && organizadas == "nao") {
            div_resultado_conferir.innerHTML = '';
            div_resultado_conferir.innerHTML = 'O melhor setor para você é o sul';
            setorTorcedor = 'sul';
            imagemSetor.src = "";
            imagemSetor.src = "../assets/imgs/setores/setores_sul.png";

        }

        else if (torce == "sim" && nvlPrivacidade == 4 && crianca == "sim" && dinheiro == 2 && visaoCampo == "horizontal" && organizadas == "nao") {
            div_resultado_conferir.innerHTML = '';
            div_resultado_conferir.innerHTML = 'O melhor setor para você é o leste';
            setorTorcedor = 'leste';
            imagemSetor.src = "";
            imagemSetor.src = "../assets/imgs/setores/setores_leste.png";
        }

        else if (torce == "sim" && nvlPrivacidade == 3 && crianca == "sim" && dinheiro == 3 && visaoCampo == "horizontal" && organizadas == "nao") {
            div_resultado_conferir.innerHTML = '';
            div_resultado_conferir.innerHTML = 'O melhor setor para você é o oeste';
            setorTorcedor = 'oeste';
            imagemSetor.src = "";
            imagemSetor.src = "../assets/imgs/setores/setores_oeste.png";

        }

        else if (torce == "sim" && nvlPrivacidade == 1 && crianca == "sim" && dinheiro == 5 && visaoCampo == "horizontal" && organizadas == "nao") {
            div_resultado_conferir.innerHTML = '';
            div_resultado_conferir.innerHTML = 'O melhor setor para você é o oeste business';
            setorTorcedor = 'oesteB';
            imagemSetor.src = "";
            imagemSetor.src = "../assets/imgs/setores/setores_oesteB.png";

        }

        else {
            imagemSetor.src = "";
            div_resultado_conferir.innerHTML = 'Não foi possível achar um setor perfeito para você';
        }

    }

    function atualizacaoPeriodica() {
        obterdados('norte');
        obterdados('sul');
        obterdados('leste');
        obterdados('oeste');
        obterdados('oesteB');
        obterdados('visitante');



    }
    function obterdados(setor) {
        fetch(`/medidas/contagem/${setor}`)
            .then(resposta => {

                if (resposta.ok) {
                    resposta.json().then(resposta => {

                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                        var dados = {
                            quantidade: resposta[0].quantidade,
                        }

                        plotar(resposta[0].quantidade, setor);
                    });
                } else {

                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados do aquario p/ gráfico: ${error.message}`);
            });

    }

    function plotar(quantidade, setor) {

        if (setor == 'visitante') {
            cardVisitante.innerHTML = quantidade;

        } else if (setor == 'norte') {
            cardNorte.innerHTML = quantidade;

        } else if (setor == 'sul') {
            cardSul.innerHTML = quantidade;

        } else if (setor == 'leste') {
            cardLeste.innerHTML = quantidade;
        } else if (setor == 'oeste') {
            cardOeste.innerHTML = quantidade;
        }
        else if (setor == 'oesteB') {
            cardOesteB.innerHTML = quantidade;
        }


    }

    var idUsuario = sessionStorage.getItem("ID_USUARIO")
    function salvarSetor() {


        fetch("/medidas/salvarSetor", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idUsuario: idUsuario,
                setorTorcedor: setorTorcedor

            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {

                atualizacaoPeriodica();

            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });

        return false;
    }

</script>

</html>